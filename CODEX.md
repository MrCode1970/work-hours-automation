Проект: **work-hours-automation**
Путь: `/home/vitaliy/mr1970code/work-hours-automation`

### Цель

Автоматизировать контроль рабочего времени:

1. скачать Excel-отчёт с портала `https://ins.ylm.co.il` через Playwright;
2. сравнить данные с моим “эталоном” в Google Sheets;
3. создать лист **«Изменения M.YY»** (текущее состояние расхождений) **по строго заданному формату**.
   Важно: это не “лог событий”, а **витрина текущих расхождений**. Если расхождений нет — лист изменений должен исчезать.

### Главное правило

**Не перезаписывать мои уже внесённые данные**, кроме одного исключения:

* если в основном листе месяца `M.YY` (эталон) ячейка входа/выхода пустая, а на сайте значение есть — можно **дополнить пустую ячейку** (C/D) значением с сайта.

### Текущая архитектура (плоская)

* `run.py` — точка входа, управляет сценарием.
* `config.py` — env/настройки. Есть флаг `SKIP_DOWNLOAD=1` чтобы не ходить на сайт и использовать локальный `local_data.xlsx`.
* `ylm_portal.py` — Playwright: логин и скачивание Excel.
* `sheets_client.py` — Google Sheets: сервисный аккаунт, выбор spreadsheet и листа месяца.
* `sync_logic.py` — бизнес-логика сравнения и создание листа “Изменения”.

### Данные

Excel с сайта содержит колонки (иврит):

* `תאריך` (дата)
* `כניסה` (вход)
* `יציאה` (выход)

Google Sheet:

* лист месяца называется `M.YY` (например `1.26`), выбор делается через `month_sheet_name()` в `sheets_client.py`.
* на листе месяца:

  * дата в колонке **B**
  * вход в колонке **C**
  * выход в колонке **D**

### Требуемый формат листа «Изменения M.YY»

Лист должен называться: **`Изменения M.YY`** (например `Изменения 1.26`)

В листе:

* A1: `Дата изменений: DD.MM.YYYY` (дата запуска/проверки)
* Заголовки на строке 3:

  * `Дата | Вход (мой) | Выход (мой) | Вход (сайт) | Выход (сайт) | Разница`
* Строки ниже (с 4-й):

  * показывать **только даты, где есть расхождение** (после возможного дополнения пустых моих значений)
* Столбец «Разница»:

  * вычислять разницу по дню только если у обеих сторон есть пара вход+выход;
  * формат разницы: `+H:MM` или `-H:MM`;
  * если нельзя посчитать (не хватает входа/выхода) — оставить пусто.
* Внизу: строка `Итого:` и сумма разниц (учитывать только те строки, где разница рассчитана).
* Цвета:

  * фон столбцов “мой” (B:C) — один цвет (мягкий серый),
  * фон столбцов “сайт” (D:E) — другой цвет (мягкий жёлтый),
  * если значение сайта отличается от моего: текст сайта красный если меньше, зелёный если больше,
  * разница: красная если отрицательная, зелёная если положительная.

Если расхождений нет:

* лист **`Изменения M.YY`** должен быть удалён (или не создан).

### Ограничения и приоритеты

1. Изменения делать минимальными и безопасными.
2. Не усложнять архитектуру без необходимости.
3. Не добавлять новые сущности (статусы, timestamps на строки, аудит-логи) — это не нужно.
4. Время нормализовать к `HH:MM` перед сравнением (`7:00` == `07:00`).
5. `SKIP_DOWNLOAD=1` должен позволять тестировать логику без доступа к сайту (используем `local_data.xlsx`).

### Как запускать

* Без сайта (тест логики):
  `SKIP_DOWNLOAD=1 ./run.sh`
* С сайтом:
  `./run.sh` (или `SKIP_DOWNLOAD=0`)

### Что просить у пользователя при необходимости

Если нужно проверить поведение:

* попросить пользователя запустить и прислать traceback/лог;
* не требовать secrets (они есть в окружении/Actions, но недоступны Codex).

### Что считать “готово”

* Лист «Изменения M.YY» корректно появляется/исчезает.
* Нет ложных расхождений из-за формата времени.
* Пустые мои значения дополняются значениями с сайта.
* Разница не считается на неполных данных.
* Визуальное оформление соответствует описанию.
