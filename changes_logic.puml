@startuml
title Изменения M.YY — текущая логика заполнения/сравнения

start
:Загрузка local_data.xlsx (табель с сайта);
if (есть колонки תאריך/כניסה/יציאה?) then (да)
  :Сбор интервалов по датам (site_by_date);
else (нет)
  stop
endif

:Загрузка листа месяца (base_ws);
:Чтение диапазона B:L;
:Индекс по дате из колонки B -> base_by_date;

repeat
  :Берем дату и интервалы из site_by_date;
  :Ищем дату в base_by_date (B);
  if (даты нет в листе) then (нет)
    :Пропустить (не изменение);
  else (да)
    :Определяем интервал 1 и 2 (сортировка по времени);
    :Сравнение с моими значениями (C/D и K/L);

    if (C/D пустые и на сайте есть время) then (да)
      :Заполняем C/D;
      if (строка была пустая и есть 2-й интервал) then (да)
        :Заполняем K/L;
      endif
    endif

    if (есть различия main/bonus) then (да)
      :Добавить строку в "Изменения M.YY";
    endif
  endif
repeat while (есть даты)

if (есть изменения?) then (да)
  :Пересоздать лист "Изменения M.YY";
else (нет)
  :Удалить лист "Изменения M.YY" (если есть);
endif

stop
@enduml
